# DavStack Store

Davstack store is a state management library built on top of zustand that provides a more practical API for managing state in React applications, with support for actions, computed properties, and local state management.

[Zustand](https://github.com/pmndrs/zustand) is a small, fast and scalable state-management solution battle-tested against common pitfalls, like the dreaded [zombie child problem](https://react-redux.js.org/api/hooks#stale-props-and-zombie-children), [react concurrency](https://github.com/bvaughn/rfcs/blob/useMutableSource/text/0000-use-mutable-source.md), and [context loss](https://github.com/facebook/react/issues/13332) between mixed renderers.

## Installation

```bash
npm install zustand @davstack/store
```

## Key Features and benefits over Zustand

1. **Simple API**: Define state and getters/setters/hooks/types are automatically generated. No need to write boilerplate code.
2. **Computed Properties and Actions**: Define derived state and actions that automatically update when dependent state changes.
3. **Local State Management**: Scope state to a subtree of components using the `LocalProvider` component.

## Basic Example

```tsx
import { createStore } from '@davstack/store';

// Create a store with an initial state, and the types will be inferred automatically
const personStore = createStore({
	name: 'John Doe',
	age: 30,
});

const Component = () => {
	// Use the autogenerated `use` hook to selectively subscribe to state changes
	const name = personStore.name.use();
	const age = personStore.age.use();

	return (
		<div>
			<p>Name: {name}</p>
			<p>Age: {age}</p>
			<input
				value={name}
				onChange={(e) => {
					// Update state using the autogenerated `set` method
					personStore.name.set(e.target.value);
				}}
			/>
			<button
				onClick={() => {
					// Get the current state value using the autogenerated `get` method
					// and update state using the `set` method
					personStore.age.set(personStore.age.get() + 1);
				}}
			>
				Increment Age
			</button>
		</div>
	);
};
```

## Getting Started

# Creating a Store

To create a store, use the `createStore` function and define your initial state:

```tsx
import { createStore } from '@davstack/store';

const myStore = createStore({
	count: 0,
	name: undefined as string | undefined, // can also cast to change the inferred type
});
```

### Defining Actions and Computed Properties

Use the `extend` method to define actions and computed properties:

```tsx
const counterStore = createStore({ count: 0 }).extend((store) => ({
	increment() {
		store.count.set(store.count.get() + 1);
	},
	decrement() {
		store.count.set(store.count.get() - 1);
	},
	getDoubled() {
		return store.count.get() * 2;
	},
}));
```

### Using Store in Components

Access state, computed properties, and actions in your components using the `use` method:

```tsx
import React from 'react';
import { counterStore } from './store';

const Counter = () => {
	const count = counterStore.count.use();
	const doubled = counterStore.getDoubled();

	return (
		<div>
			<p>Count: {count}</p>
			<p>Doubled: {doubled}</p>
			<button onClick={counterStore.increment}>Increment</button>
			<button onClick={counterStore.decrement}>Decrement</button>
		</div>
	);
};
```

### Updating State

Update state using the `set` method or by directly mutating state properties within actions:

```tsx
counterStore.count.set(10);
counterStore.set((state) => {
	state.count = 10;
});
counterStore.assign({ count: 10 });
```

### Accessing State Outside Components

Get a snapshot of the state using the `get` method:

```tsx
const currentCount = counterStore.count.get();
```

### Local State Management

Use the `LocalProvider` component to scope state to a subtree of components:

```tsx
import React from 'react';
import { counterStore } from './store';

const ParentComponent = () => {
	return (
		<counterStore.LocalProvider initialValue={{ count: 5 }}>
			<ChildComponent />
		</counterStore.LocalProvider>
	);
};

const ChildComponent = () => {
	const localStore = counterStore.useLocalStore();
	const count = localStore.count.use();

	return <div>Count: {count}</div>;
};
```

## Caveats

- The library is designed to work with React and may not be suitable for other frameworks or non-React environments.
- Be mindful of the order in which you call the store methods. `createStore` should always be called first, followed by `extend` and other methods.

For more detailed examples and advanced usage, please refer to the [documentation](link-to-documentation) and [examples](link-to-examples).

## Contributing

Contributions are welcome! Please read our [contributing guide](link-to-contributing-guide) for details on our code of conduct and the submission process.

## License

This project is licensed under the [MIT License](link-to-license). See the LICENSE file for details.
